<div class="inside_banner stores_banner text-center">
    <h3>Store Directory</h3>
</div>
<div class="store_list_head main_container ">
    <div class="row hidden_phone">
        <div class="col-md-4">
            <h5 class="active_heading">Directory</h5>
        </div>
        <div class="col-md-4">
            <h5><a href="/map">Center Map</a></h5>
        </div>
        <div class="col-md-4">
            <h5><a href="/promotions">Promotions</a></h5>
        </div>
    </div>
    <h5 class="text-center tap_here show_phone">
        <select id="option_selector" class="link_selector">
            <option value="" disabled selected>TAP FOR MORE OPTIONS</option>
            <option value="/map">Center Map</option>
            <option value="/promotions">Promotions</option>
        </select>
    </h5>
</div>
<div class="content_container main_container">
    <div class="margin_25_across">
        <div class="row">
            <div class="col-md-6">
                <div class="promotions_header_container store_search" >
                    <label class="">
                        <input type="text" placeholder="Search" id="store_search" />
                        <img src="//codecloud.cdn.speedyrails.net/sites/58bdb9106e6f644783090000/image/png/1488985579000/search-512.png" class="pull-right" id="store_search_img" alt="">
                        <i id="close_search_results" class="fa fa-times-circle hidden_now"></i>
                    </label>
                    <div class="search_results" id="store_search_results"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="promotions_header_container dropdown category_selector">
                    <a id="store_cat_list" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        Sort by Category 
                        <span class="dropdown_arrow"><i class="fa fa-angle-down" aria-hidden="true"></i></span>
                    </a>
                    <ul class="dropdown-menu cat_list" aria-labelledby="dropdownMenu1" id="category_select">
                        <script id="category_select_template" type="x-tmpl-mustache/text">
				            <li class="show_cat_stores" data-id="{{id}}" name="{{name}}">{{name}}</li>
				        </script>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="alpha_list">
                    <a href="#7">#</a>
                    <a href="#A">A</a>
                    <a href="#B">B</a>
                    <a href="#C">C</a>
                    <a href="#D">D</a>
                    <a href="#E">E</a>
                    <a href="#F">F</a>
                    <a href="#G">G</a>
                    <a href="#H">H</a>
                    <a href="#I">I</a>
                    <a href="#J">J</a>
                    <a href="#K">K</a>
                    <a href="#L">L</a>
                    <a href="#M">M</a>
                    <a href="#N">N</a>
                    <a href="#O">O</a>
                    <a href="#P">P</a>
                    <a href="#Q">Q</a>
                    <a href="#R">R</a>
                    <a href="#S">S</a>
                    <a href="#T">T</a>
                    <a href="#U">U</a>
                    <a href="#V">V</a>
                    <a href="#W">W</a>
                    <a href="#X">X</a>
                    <a href="#Y">Y</a>
                    <a href="#Z">Z</a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="content_container main_container">
    <div class="margin_25_across">
        <div class="row">
            <div id="store_list_container">
                <script id="store_list_template" type="x-tmpl-mustache/text">
                    <div class="col-xs-6 col-sm-3  cats_row" data-cat="{{cat_list}}">
                        <div class="store_logo_container" id="{{initial}}">
                            <a href="/stores/{{slug}}">
                                <img style="{{initial_img}}" src="{{store_front_url_abs}}"/>
                                <div class="store_coming_soon" style="{{coming_soon_store}}">
                                    <div class="new_store">Coming soon</div>
                                </div>
                                <div class="store_list_promos">
                                    <span class="promo_exist" style="{{job_exist}}"><img src="//codecloud.cdn.speedyrails.net/sites/58bdb9106e6f644783090000/image/png/1489000358000/jobs.png" alt="Job Icon"> {{job_list}}</span>
                                    <span class="promo_exist" style="{{promotion_exist}}"><img src="//codecloud.cdn.speedyrails.net/sites/58bdb9106e6f644783090000/image/png/1489000371000/promotions.png" alt="Promotion Icon">{{promotion_list}}</span>
                                </div>
                            </a>
                        </div>
                    </div>
                </script>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            var categories = getStoreCategories();
            var category_list = [];
            $.each( categories, function( key, val ){
                if (val.store_ids != null) {
                    category_list.push(val);
                } 
            });
            renderGeneral("#category_select", "#category_select_template", category_list);
            $('#category_select').prepend('<li class="show_cat_stores" data-id="000" name="All">ALL</li>');
            
            var all_stores = getStoresList();
            var stores = [];
            var query = window.location.search;
            if(query !== "") {
                var search_part = query.split('?')[1];
                var query_type = search_part.split('=')[0];
                var cat_name = search_part.split('=')[1];
                console.log("query_type", query_type,"cat_name", cat_name)
                if(query_type == "category"){
                   cat_name = cat_name.replace("%20"," ");
                   var category = _.find(categories, function(o){
                    //   console.log("o", o)
                    //   console.log(_.lowerCase(o.name) , _.lowerCase(cat_name), _.lowerCase(o.name) == _.lowerCase(cat_name))
                      return  _.lowerCase(o.name) == _.lowerCase(cat_name);
                   });
                   stores = _.filter(all_stores, function(o){
                       return _.includes(o.categories, category.if)
                   })
                   console.log("category", category)
                }
                else {
                    stores = all_stores;
                }
            } else {
                stores = all_stores;
            }
            renderStoreList('#store_list_container','#store_list_template', stores, "stores");
            renderGeneral('#category_container', '#category_template', category_list);
            renderGeneral('#category_container_phone', '#category_template_phone', category_list);
            
            show_content();
            
            store_search();
            show_cat_stores();
        }
        loadMallDataCached(renderAll); 
    });
</script>