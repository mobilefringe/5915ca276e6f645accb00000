<div class="main_banner text-center">
    <h3>DEALS</h3>
    <p>explore • enjoy • shop</p>
</div>
<div class="store_list_head main_container">
    <div class="row hidden_phone">
        <div class="col-md-4 spec_offer">
            <h5 class="active_heading">PROMOTIONS</h5>
        </div>
        <div class="col-md-4 spec_offer">
            
        </div>
        <div class="col-md-4 spec_offer">
            
        </div>
    </div>
    <h5 class="text-center tap_here show_phone">
        <select id="option_selector" class="link_selector">
            <option value="" disabled selected>TAP FOR MORE OPTIONS</option>
            <option value="/events">Events</option>
            <option class="contest_link" value="/contests">Contest</option>
        </select>
    </h5>
</div>
 <div class="content_container main_container">
    <div class="margin_25_across">
        <div class="row">
            <div class="col-md-4">
                <div class="promotions_header_container store_search" >
                    <label class="">
                        <input type="text" placeholder="Search" id="store_search" />
                        <img src="//codecloud.cdn.speedyrails.net/sites/58bdb9106e6f644783090000/image/png/1488985579000/search-512.png" class="pull-right" id="store_search_img" alt="">
                        <i id="close_search_results" class="fa fa-times-circle hidden_now"></i>
                    </label>
                    <div class="search_results" id="store_search_results"></div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="promotions_header_container dropdown category_selector">
                    <a class="" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        Sort by Category 
                        <span class="dropdown_arrow"><i class="fa fa-angle-down" aria-hidden="true"></i></span>
                    </a>
                    <ul class="dropdown-menu cat_list" aria-labelledby="dropdownMenu1" id="category_select">
                        <script id="category_select_template" type="x-tmpl-mustache/text">
				            <li class="show_cat_stores" data-id="{{id}}">{{name}}</li>
				        </script>
                    </ul>
                </div>
            </div>
            <div class="col-md-4">
                <a href="/directory">
                    <div class="promotions_header_container directory_btn">View Directory</div>
                </a>
            </div>
        </div>
        <div class="row">
            <div id="promos_container" class="promos_page">
                <script id="promos_template" type="x-tmpl-mustache/text">
                    <div class="col-sm-6 col-md-4 margin_50 cats_row" data-cat="{{cat_list}}">
                        <div class="promo_container" value="{{categories}}">
                            <div class="promo_img_container">
                                <img src="{{image_url}}" alt="Promotion" class="promo_img" />
                            </div>
                            <div class="details">
                                <h3 class="details_header">{{name_short}}</h3>
                                <h3 class="details_store_name">{{store_name}}</h3>
                                <h3 class="jobs_publish_date"><i class="fa fa-calendar"></i> &nbsp;{{dates}}</h3>    
                            </div>
                            <a href="/promotions/{{slug}}" class="read_more_btn">Read More</a>
                        </div>
                    </div>
                </script>
            </div>
            <div class="col-md-12">
                <h3 id="no_promos" class="hidden_now">There are currently no promotions available, please check back again later.</h3>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function(e){
        init(e);
        function renderAll (){
            var promotions = getPromotionsList().sortBy(function(o){ return o.start_date });
            var categories = getStoreCategories();
            renderGeneral('#category_container', '#category_template', categories);
            renderGeneral('#mobile_cat_list', '#category_template2', categories);
            $('#mobile_cat_list').prepend('<option value="all" selected >All Categories</option>');
            show_cat_stores()
            var published_promos = [];
            $.each( promotions , function( key, val ){
                var today = moment();
                var webDate = moment(val.show_on_web_date);
                if (today >= webDate) {
                    published_promos.push(val)
                } 
            });
            if(published_promos.length > 0){
                renderPromotions("#promos_container","#promos_template", published_promos, "Halifax");
            }
            else{
                $('#no_promos').show()
            }
            show_content();
        }
		loadMallDataCached(renderAll); 
    })
</script>