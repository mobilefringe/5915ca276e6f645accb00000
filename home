<div class="popup_home hidden_now">
    <a href="#">
        <img src="#" alt="pop up" />
    </a>
    <i class="fa fa-remove close_popup"></i>
</div>
<div class="home_banner">
    <div class="flexslider text-center">
        <ul class="slides" id="home_banner">
            <script id="banner_template" type="x-tmpl-mustache/text">
                <li class="position_relative">
                    <a href="{{url}}" {{css}} onclick="{{noLink}}">
                        <div class="hero_banner" style="background-image: url({{image_url}})"></div>
                    </a>
                </li>
            </script>
        </ul>
    </div>
</div>
<div class="content_container main_container">
    <div class="feature_items_box mobile_padding">
        <div class="feature_row">
            <div class="feature_item">
                <div id="feature_0" class="position_relative"></div>
            </div>
            <div class="feature_item">
                <div id="feature_1" class="position_relative"></div>
                <div id="feature_2" class="position_relative"></div>
            </div>
            <div class="feature_item">
                <div id="feature_3" class="position_relative"></div>
                <div id="feature_4" class="position_relative"></div>
            </div>
            <div class="feature_item">
                <div id="feature_5" class="position_relative"></div>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
    <div class="instagram_container mobile_padding">
        <h5 class="insta_title">Our Feed</h5>
        <div id="insta_container" class="socialize_div">
            <script id="insta_template" type="x-tmpl-mustache/text">
                <div class="ig-image">
                    <a href="{{link}}" target="_blank" title="{{caption}}">
                        <img src="{{image}}" />
                    </a>
                </div>
            </script>
        </div>
    </div>
</div>
<style>
    .newsletter_container {
        margin-top: 0;
    }
</style>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            var banners = getBanners();
            renderBanner('#banner_template','#home_banner',banners);
             
            renderFeatureItems();
            
            var today_hours = getTodaysHours();
            renderHomeHours('#home_hours_container2', '#home_hours_template2', today_hours)   
            
            // loadSocialFeeds(render_social)
            renderInstaFeed('#insta_container', '#insta_template');
            
            show_content();
            
            if($.cookie("popup_viewed") != "true"){
                $.cookie("popup_viewed", "true", { expires: 1 });
                var popup = getPopups()[0];
                if (popup != undefined){
                    $('.popup_home a').attr('href', popup.photo_link)
                    $('.popup_home img').attr('src', '//mallmaverick.cdn.speedyrails.net' + popup.photo_url)
                    $('<div class="modal-backdrop custom_backdrop"></div>').appendTo(document.body);
                    $('.popup_home').show()
                }
            }
            $('.close_popup, .custom_backdrop').click(function(){
                $(".modal-backdrop").remove();
		        $(".popup_home").remove();
            });
            
            $('.flexslider').flexslider({
                animation: "slide",
                pauseOnHover: true,
            });
            $(".flex-prev").html("");
            $(".flex-next").html("");
        }
        
        loadMallDataCached(renderAll); 
    });
    
    function render_social(){
        var social_feed = getSocialFeed();
        var latest_tweet = social_feed.twitter[0]
        var latest_fb_post = social_feed.facebook[0]
        if(latest_tweet.text.length > 100){
            $('#latest_tweet').text(latest_tweet.text.substr(0,100) + "...")
        } else {
            $('#latest_tweet').text(latest_tweet.text)
        }
        $('#latest_tweet_link').attr('href', latest_tweet.link)
        var tweet_date = new Date(latest_tweet.created_at.split(',')[0])
        $('#latest_tweet_date').text(get_month(tweet_date.getMonth()) + " " + tweet_date.getDate())
        
        if(latest_fb_post.text.length > 100){
            $('#latest_fb').text(latest_fb_post.text.substr(0,100) + "...")
        } else {
            $('#latest_fb').text(latest_fb_post.text)
        }
        $('#latest_fb_link').attr('href', latest_fb_post.link)
        var fb_date = new Date(latest_fb_post.created_at.split(',')[0])
        $('#latest_fb_date').text(get_month(fb_date.getMonth()) + " " + fb_date.getDate())
    }
</script>