<style>
    .details_image {
        margin-bottom: 30px;
    }
    #contest_btn {
        margin-top: 0;
    }
</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.3.26/jquery.form-validator.min.js"></script>
<div class="pages_banner text-center">
    <h3 class="mm_page_title">Contest</h3>
</div>
<div class="margin_20"></div>
<div class="content_container main_container">
    <div class="margin_25_across">
        <div class="row">
            <div class="col-md-12">
                <div id="contest_details_container">
                    <script id="contest_details_template" type="x-tmpl-mustache/text">
                        <h2 class="margin_30 promo_list_name bold">{{name}}</h2>
                        <img class="details_image" src="{{alt_photo_url}}" style="{{promo_image}}" />
                        <div class="details_desc margin_30">{{{rich_description}}}</div>
                        <form id="contest_form">
                            <input id="property_id" name="contest[property_id]" type="hidden" value="{{property_id}}"/>
                            <input id="contest_id" name="contest[contest_id]" type="hidden"  value="{{id}}" />
                            <input type="hidden" name="cm-name" id="cm-name" />
                            <div class="row ">
                                <div class="col-md-6 margin_30">
                                    <label for="first_name">First Name *</label>  
                                    <input class="form-control" id="first_name" name="contest[first_name]" type="text" required data-validation="required"  />
                                </div>
                                <div class="col-md-6 margin_30">
                                    <label for="last_name">Last Name *</label>  
                                    <input class="form-control" id="last_name" name="contest[last_name]" type="text" required data-validation="required" />
                                </div>
                            </div>
                            <div class="row ">
                                <div class="col-md-6 margin_30">
                                    <label for="email">Email *</label> 
                                    <input class="form-control" id="email" name="contest[email]" type="email" required data-validation-regexp="^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$" data-validation-error-msg="The input value is incorrect email address" data-validation="custom" />
                                </div>
                                <div class="col-md-6 margin_30">
                                    <label for="phone_number">Phone Number</label>  
                                    <input class="form-control" id="phone_number" name="contest[phone]" type="text"  />
                                </div>
                            </div>
                            <div class="row ">
                                <div class="col-md-4 margin_30">
                                    <label for="postal_code">Zip Code</label> 
                                    <input class="form-control" id="postal_code" name="contest[postal_code]" type="text"  />
                                </div>
                                <div class="col-md-2 margin_30">
                                    <label for="age">Age</label> 
                                    <input class="form-control" id="age" name="contest[age]" type="text"  />
                                </div>
                                <div class="col-md-6 margin_30">
                                    <label for="gender">Gender</label>  
                                    <select class="form-control" id="gender" name="contest[gender]">
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 margin_30">
                                    <label class="cbox_label">
                                        <input id="newsletter_signup" type="checkbox" name="contest[newsletter]" required/> 
                                        I agree to receive communications from {{property_name}} and can unsubscribe anytime.
                                    </label>
                                </div>
                                <div class="col-md-12 margin_30">
                                    <label class="cbox_label">
                                        <input id="agree_terms" type="checkbox" name="contest[terms]" required/> 
                                        I have read and agree to the <a href="/pages/orchardtown-the-orchard-town-center-sweepstakes-terms-and-conditions" target="_blank">Contest Rules & Regulations</a>.
                                    </label>
                                </div>
                                <div class="col-md-12 margin_30">
                                    <p>For more details about personal privacy, please read our <a href="/pages/orchardtown-privacy-policy" target="_blank">Privacy Policy.</a></p>
                                </div>
                                <div class="col-md-12">
                                    <div class="margin_30">
                                        <button class="newsletter_btn animated_btn text-center" id="contest_btn">Submit</button>
                                    </div>
                                    <p class="" id="succes_msg" style="display:none">Thank you! Your entry has been received.</p>
                                </div>
                            </div>
                        </form>
                    </script>
                </div>
                <div id="no_contest_details_container" style="display:none;>
                    <p>Sorry, there is no contest running right now! Please check back soon.</p>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function(e){
        init(e);
        loadMallDataCached(renderPage);
    })
    
    function renderPage(){
        var contest_list = getContestList();
        var current_contest =_.find(contest_list,function(o){
            return o.start_date && _.includes(val.show_on_slug, "orchardtown-contest")
        })
        // $.each( contest_list, function( key, val ){
        //     if (_.includes(val.show_on_slug, "orchardtown-contest")) {
        //         if (val.start_date) {
        //             current_contest.push(val);
        //         }    
        //     }
        // });
        // current_contest = current_contest[0]
        console.log(contest_list)
        if(current_contest) {
            var slug = current_contest.slug;
            var contest_details = getContestBySlug(current_contest.slug);
            renderContest("#contest_details_container", '#contest_details_template', contest_details)
        } else {
            $('#no_contest_details_container').show()
        }
        
        show_content();
        
        $.validate();
        
        $('#contest_form').submit(function(e){
            e.preventDefault();
            $('#contest_btn').prop('disabled', true);
            submit_contest(slug);
        })
    }
</script>